services:
  dokuwiki:
    build:
      context: .
      dockerfile: app/Dockerfile
    ports:
      - "8080:80"
    environment:
      - PHP_MEMORY_LIMIT=256M
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-changeme}
      - DEMO_USERS=${DEMO_USERS:-0}
      - S3_BACKUP_BUCKET=${S3_BACKUP_BUCKET:-}
      - S3_BACKUP_PREFIX=${S3_BACKUP_PREFIX:-dokuwiki}
      - S3_BACKUP_ON_START=${S3_BACKUP_ON_START:-0}
      - S3_BACKUP_CRON=${S3_BACKUP_CRON:-}
      - CLEAR_CACHE_ON_START=${CLEAR_CACHE_ON_START:-0}
    volumes:
      # For local dev: bind mount converted pages from content/
      # In production (ECS), these are EFS volumes seeded by entrypoint
      - dokuwiki_data:/var/www/dokuwiki/data
      - dokuwiki_conf:/var/www/dokuwiki/conf
      - dokuwiki_plugins:/var/www/dokuwiki/lib/plugins
    restart: unless-stopped

volumes:
  dokuwiki_data:
  dokuwiki_conf:
  dokuwiki_plugins:
